# 2026-02-03 연구 계획: Zero-SE 현상 정량화 및 다중 데이터셋 검증

## 0. 배경

### 조교님 방향 (260121 미팅)
> "Zero-SE 문제를 Energy가 해결한다"를 스토리 방향으로 잡고, Ensemble 전략(Fallback) 변경 시도.
> 더 다양한 데이터셋에서 Baseline 측정과 함께 제안 기법 적용.

### 수정된 논문 스토리라인
1. **문제 제기**: 불확실성 기반 환각 탐지기는 "불확실할수록 환각" 전제 → LLM은 **확신하면서도 틀릴 수 있다** (Zero-SE 문제)
2. **핵심 발견**: Zero-SE (SE ≈ 0)에서도 환각 비율이 높음. SE는 self-consistency를 측정하지 truth를 측정하지 않는다
3. **메커니즘**: SE = confusion 탐지기, Energy = confabulation/overconfidence 탐지기. 서로 다른 실패 모드를 담당
4. **방법론**: SE-gated cascade — SE가 과신 영역(low SE)을 가리키면 Energy로 전환
5. **시사점**: 단일 글로벌 점수가 아닌 **regime-aware 조건부 탐지** 필요

---

## 1. 이번 실험 목표

### 1.1 핵심 질문
> "Zero-SE 현상이 TruthfulQA/HaluEval 외의 다른 데이터셋에서도 존재하는가?"
> "Energy가 Zero-SE 영역에서 일관되게 환각을 탐지하는가?"

### 1.2 실험 구성

| # | 실험 | 목적 | 데이터셋 |
|---|------|------|----------|
| **E1** | Zero-SE 정량화 | 기존 데이터 심층 분석 | TruthfulQA, HaluEval (기존) |
| **E2** | 데이터셋 확장 | 새 데이터셋에서 SE/Energy 측정 | TriviaQA, NQ, HaluEval-dialogue |
| **E3** | SE 구간별 분석 | SE bin별 Energy 효과 크로스오버 | 전체 데이터셋 |
| **E4** | Cascade sweep | SE-gated fallback τ 최적화 + 교차검증 | 전체 데이터셋 |

---

## 2. E1: Zero-SE 현상 정량화 (기존 데이터)

### 방법
기존 exp01/exp02 결과(각 200 samples)에서 Zero-SE 분석 확장:

```
각 데이터셋 × ε ∈ {0.001, 0.01, 0.05, 0.1} 에서:
  1. Zero-SE 비율: P(SE ≤ ε)
  2. Zero-SE 내 환각률: P(Hallucination | SE ≤ ε)
  3. Zero-SE 내 Energy AUROC (핵심!)
  4. Zero-SE 내 SE AUROC (대조군 - 거의 무의미 예상)
```

### 기대 결과

| Dataset | ε | Zero-SE % | Halluc% | Energy AUROC | SE AUROC |
|---------|---|-----------|---------|-------------|---------|
| TruthfulQA | 0.001 | ~15% | ~75% | ~0.77 | ~0.50 |
| TruthfulQA | 0.1 | ~20% | ~75% | ~0.77 | ~0.50 |
| HaluEval | 0.001 | ~50% | ~10% | ~0.60 | ~0.50 |
| HaluEval | 0.1 | ~57% | ~10% | ~0.60 | ~0.50 |

---

## 3. E2: 데이터셋 확장

### 추가 데이터셋

| 데이터셋 | HF ID | Split | 라벨링 방식 | 예상 특성 |
|----------|-------|-------|------------|----------|
| **TriviaQA** | `trivia_qa/rc.nocontext` | validation | gold answer string match | 잘 알려진 지식, SE 우세 예상 |
| **NaturalQuestions** | `nq_open` | validation | gold answer string match | 일반 QA, 혼합 예상 |
| **HaluEval-dialogue** | `pminervini/HaluEval/dialogue` | data | HaluEval 포맷 | knowledge 기반, Energy 우세 예상 |

### 실험 설정 (기존과 동일)
- LLM: Qwen2.5-3B-Instruct
- NLI: DeBERTa-large-mnli
- 샘플링: K=5, temperature=0.7
- 샘플 수: 각 200개

---

## 4. E3: SE 구간별 분석

### SE Bins
```
Bin 0: [0, ε]         — Zero-SE (핵심 영역)
Bin 1: (ε, 0.3]       — Low SE
Bin 2: (0.3, 0.6]     — Medium SE
Bin 3: (0.6, 1.0]     — High SE
Bin 4: (1.0, ∞)       — Very High SE
```

### 각 bin에서 계산
- 환각률
- SE AUROC
- Energy AUROC
- 샘플 수 (n)

### 기대 패턴
- Zero-SE bin: Energy >> SE (핵심 주장)
- High-SE bin: SE >> Energy (상보성)
- Crossover 존재: SE-gated cascade의 근거

---

## 5. E4: Cascade Threshold Sweep

### 방법
```python
# Cascade 정의
if SE < τ:
    score = normalize(Energy)
else:
    score = normalize(SE)

# τ sweep: 0 → max(SE) in 50 steps
# 각 τ에서 AUROC, AUPRC 계산
```

### 교차 검증
- τ를 dataset A에서 선택 → dataset B에서 테스트
- 핵심: "τ가 라벨 없이 작동하는가?"에 대한 답

---

## 6. 실험 결과 요약 (2026-02-06 완료)

> 전체 결과는 `experiment_notes/exp07_zero_se_analysis/RESULTS.md` 참조

### 6.1 핵심 수치

| 데이터셋 | Zero-SE% | Zero-SE 환각률 | **Energy AUROC (Zero-SE)** | Crossover? |
|----------|---------|---------------|--------------------------|-----------|
| TruthfulQA | 19.0% | 73.7% | **0.736** | ✅ |
| HaluEval-QA | 53.5% | 9.3% | **0.602** | ✅ |
| TriviaQA | 29.0% | 29.3% | **0.689** | ✅ |
| NaturalQuestions | 17.0% | 50.0% | 0.457 | ❌ |
| HaluEval-dialogue | 24.5% | 89.8% | 0.486 | ❌ |

### 6.2 강한 근거 (5/5 데이터셋)
- Energy만 잡는 환각이 모든 데이터셋에서 12~24% 존재
- Cascade가 SE-only보다 나쁜 경우 없음 (최대 -1.6%)
- Oracle 탐지율 76~90%: SE+Energy 상보성 확인

### 6.3 조건부 근거 (3/5 데이터셋)
- Zero-SE에서 Energy AUROC > 0.6: TruthfulQA, TriviaQA, HaluEval-QA
- Factoid QA에서 효과적, dialogue/open-domain QA에서는 한계

### 6.4 조교님께 보고할 핵심 메시지
> "Zero-SE 문제는 모든 데이터셋에서 존재하며, Energy가 이를 보완합니다.
> Factoid QA에서는 Energy AUROC 0.69~0.74로 효과적이나,
> dialogue/open-domain에서는 추가 연구가 필요합니다.
> Cascade 전략은 SE-only 대비 해치지 않으면서 특정 데이터셋에서 +3~7% 개선합니다."

---

## 7. 파일 구조

```
hallucination_lfe/
├── 260203.md                              # 이 문서
└── experiment_notes/
    └── exp07_zero_se_analysis/
        ├── analyze_existing.py            # E1/E3/E4: 전체 분석 (GPU 불필요)
        ├── run_new_datasets.py            # E2: 새 데이터셋 실험 (GPU 필요)
        ├── analysis_results.json          # 전체 분석 결과
        ├── results_triviaqa.json          # TriviaQA 원본 결과
        ├── results_naturalquestions.json   # NQ 원본 결과
        ├── results_halueval_dialogue.json  # HaluEval-dialogue 원본 결과
        └── RESULTS.md                     # 결과 정리
```
